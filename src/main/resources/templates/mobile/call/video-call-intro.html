<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>í† ë§ˆí† ë¦¬ë©¤ë²„ - ì˜ìƒí†µí™” ì²´í—˜</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Apple SD Gothic Neo', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      position: relative;
    }

    /* ğŸ†• ë„ì›€ë§ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
    .help-button {
      position: fixed;
      top: 20px;
      right: 20px;
      width: 48px;
      height: 48px;
      background: rgba(255, 255, 255, 0.2);
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      color: white;
      font-size: 24px;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      z-index: 1000;
      text-decoration: none;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .help-button:hover {
      background: rgba(255, 255, 255, 0.3);
      border-color: rgba(255, 255, 255, 0.5);
      transform: scale(1.1);
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
    }

    .help-button:active {
      transform: scale(0.95);
    }

    /* ë„ì›€ë§ ë²„íŠ¼ í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ (ì„ íƒì‚¬í•­) */
    .help-button.pulse {
      animation: helpPulse 2s ease-in-out infinite;
    }

    @keyframes helpPulse {
      0% {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 0 0 0 rgba(255, 255, 255, 0.4);
      }
      50% {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 0 0 10px rgba(255, 255, 255, 0);
      }
      100% {
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2), 0 0 0 0 rgba(255, 255, 255, 0);
      }
    }

    /* ëª¨ë°”ì¼ì—ì„œ ë„ì›€ë§ ë²„íŠ¼ í¬ê¸° ì¡°ì • */
    @media (max-width: 768px) {
      .help-button {
        top: 15px;
        right: 15px;
        width: 44px;
        height: 44px;
        font-size: 22px;
      }
    }

    /* ê¸°ì¡´ ìŠ¤íƒ€ì¼ë“¤ ìœ ì§€ */
    .container {
      text-align: center;
      max-width: 400px;
      width: 90%;
      padding: 40px 20px;
    }

    .header {
      margin-bottom: 40px;
    }

    .logo {
      font-size: 24px;
      font-weight: bold;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .subtitle {
      font-size: 14px;
      opacity: 0.9;
      line-height: 1.4;
    }

    .phone-container {
      position: relative;
      margin: 40px auto;
      width: 200px;
      height: 400px;
    }

    .phone-frame {
      width: 100%;
      height: 100%;
      background: #2c3e50;
      border-radius: 30px;
      padding: 20px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      position: relative;
      overflow: hidden;
    }

    .phone-screen {
      width: 100%;
      height: 100%;
      background: #34495e;
      border-radius: 20px;
      position: relative;
      overflow: hidden;
    }

    .contact-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      position: absolute;
      top: 0;
      left: 0;
    }

    .contact-name {
      position: absolute;
      bottom: 100px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 12px;
      font-weight: 600;
      color: white;
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.8);
      background: rgba(0, 0, 0, 0.3);
      padding: 8px 16px;
      border-radius: 20px;
      backdrop-filter: blur(5px);
    }

    .video-call-btn {
      position: absolute;
      bottom: 30px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 60px;
      background: #e74c3c;
      border: none;
      border-radius: 30px;
      color: white;
      font-size: 24px;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(231, 76, 60, 0.4);
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .video-call-btn:hover {
      background: #c0392b;
      transform: translateX(-50%) scale(1.1);
    }

    .start-btn {
      width: 100%;
      padding: 16px;
      background: #3498db;
      border: none;
      border-radius: 25px;
      color: white;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      margin-top: 20px;
    }

    .start-btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
      box-shadow: 0 8px 25px rgba(52, 152, 219, 0.3);
    }

    /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ (ì„ íƒì‚¬í•­) */
    .toast-message {
      position: fixed;
      top: 80px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(255, 255, 255, 0.9);
      color: #333;
      padding: 12px 20px;
      border-radius: 25px;
      font-size: 14px;
      font-weight: 500;
      backdrop-filter: blur(10px);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      z-index: 1001;
      opacity: 0;
      transition: all 0.3s ease;
      pointer-events: none;
    }

    .toast-message.show {
      opacity: 1;
      transform: translateX(-50%) translateY(10px);
    }
  </style>
</head>
<body>
<!-- ğŸ†• ë„ì›€ë§ ë²„íŠ¼ ì¶”ê°€ -->
<button class="help-button pulse"
        onclick="openHelpVideo()"
        title="ì‚¬ìš©ë²• ë™ì˜ìƒ ë³´ê¸°"
        aria-label="ë„ì›€ë§ ë™ì˜ìƒ ì—´ê¸°">
  ?
</button>

<!-- í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (ì„ íƒì‚¬í•­) -->
<div id="toastMessage" class="toast-message"></div>

<div class="container">
  <div class="header">
    <div class="logo">TOMATOREMEMBER</div>
    <div class="subtitle">
      ì†Œì¤‘í•œ ì¶”ì–µì„ ì˜ì›íˆ<br>
      ê°„ì§í•˜ì„¸ìš”
    </div>
  </div>

  <div class="phone-container">
    <div class="phone-frame">
      <div class="phone-screen">
        <!-- ëª¨ë¸ì—ì„œ ë‚´ë ¤ì˜¨ ì´ë¯¸ì§€ì™€ ì´ë¦„ì„ th:src, th:alt, th:textë¡œ ë°”ì¸ë”© -->
        <img id="contactImage"
             th:src="@{${contact.image}}"
             th:alt="${contact.name}"
             class="contact-image"/>
        <div id="contactName"
             class="contact-name"
             th:text="${contact.name}">
          ì—°ë½ì²˜ëª…
        </div>
        <button class="video-call-btn" onclick="goToVideoCall()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="white">
            <path
                d="M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11l-4 4z"/>
          </svg>
        </button>
      </div>
    </div>
  </div>

  <button class="start-btn" onclick="goToMainScreen()">í† ë§ˆí† ë¦¬ë©¤ë²„ ì‹œì‘í•˜ê¸°</button>
</div>

<script th:inline="javascript">
    // ì˜ë¬¸ëª…ê³¼ í•œê¸€ëª… ëª¨ë‘ ë°›ì•„ì˜¤ê¸°
    const contactKey = /*[[${contactKey}]]*/ '';      // ì˜ë¬¸ëª… (rohmoohyun, kimgeuntae)
    const contactName = /*[[${contact.name}]]*/ '';   // í•œê¸€ëª… (ë…¸ë¬´í˜„, ê¹€ê·¼íƒœ)

    console.log('Contact Info:', {contactKey, contactName});

    // ğŸ†• ë„ì›€ë§ ë™ì˜ìƒ ì—´ê¸° í•¨ìˆ˜
    function openHelpVideo() {
        console.log('ğŸ¥ ë„ì›€ë§ ë™ì˜ìƒìœ¼ë¡œ ì´ë™');

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€ (ì„ íƒì‚¬í•­)
        showToast('ë„ì›€ë§ ë™ì˜ìƒìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤', 'info', 1500);

        // í˜„ì¬ ì°½ì—ì„œ ë°”ë¡œ ìœ íŠœë¸Œë¡œ ì´ë™
        const youtubeUrl = 'https://youtu.be/-oSW4zhocY8';

        // ì•½ê°„ì˜ ë”œë ˆì´ í›„ ì´ë™ (í† ìŠ¤íŠ¸ ë©”ì‹œì§€ ë³´ì—¬ì£¼ê¸° ìœ„í•´)
        setTimeout(() => {
            window.location.href = youtubeUrl;
        }, 500);
    }

    // ğŸ†• í† ìŠ¤íŠ¸ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜ (ì„ íƒì‚¬í•­)
    function showToast(message, type = 'info', duration = 3000) {
        const toast = document.getElementById('toastMessage');
        if (!toast) {
            return;
        }

        // ë©”ì‹œì§€ ì„¤ì •
        toast.textContent = message;
        toast.className = `toast-message show ${type}`;

        // ìë™ ìˆ¨ê¹€
        setTimeout(() => {
            toast.classList.remove('show');
        }, duration);

        console.log(`ğŸ“¢ í† ìŠ¤íŠ¸: ${message}`);
    }

    // ğŸ†• í˜ì´ì§€ ë¡œë“œ ì‹œ í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì œê±° (5ì´ˆ í›„)
    document.addEventListener('DOMContentLoaded', function () {
        console.log('ğŸš€ Info í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');

        // 5ì´ˆ í›„ í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì œê±° (ì‚¬ìš©ìê°€ ë²„íŠ¼ì„ ì¸ì§€í–ˆì„ ê²ƒìœ¼ë¡œ ê°€ì •)
        setTimeout(() => {
            const helpButton = document.querySelector('.help-button');
            if (helpButton) {
                helpButton.classList.remove('pulse');
                console.log('ğŸ’« ë„ì›€ë§ ë²„íŠ¼ í„ìŠ¤ ì• ë‹ˆë©”ì´ì…˜ ì œê±°');
            }
        }, 5000);

        // ë„ì›€ë§ ë²„íŠ¼ í´ë¦­ ì‹œ í„ìŠ¤ ì œê±°
        const helpButton = document.querySelector('.help-button');
        if (helpButton) {
            helpButton.addEventListener('click', function () {
                this.classList.remove('pulse');
            });
        }
    });

    // ===== ê¸°ì¡´ í•¨ìˆ˜ë“¤ ìœ ì§€ =====

    // ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸
    function checkLoginStatus() {
        const accessToken = localStorage.getItem('accessToken');
        const refreshToken = localStorage.getItem('refreshToken');
        const hasTokenCookie = document.cookie.includes('accessToken') ||
            document.cookie.includes('refreshToken');
        const isLoggedInFromConfig = window.APP_CONFIG?.isLoggedIn ||
            window.serverData?.isLoggedIn;

        const isLoggedIn = !!(accessToken && refreshToken) || hasTokenCookie || isLoggedInFromConfig;

        console.log('ğŸ” ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸:', {
            hasTokens: !!(accessToken && refreshToken),
            hasTokenCookie: hasTokenCookie,
            configLoggedIn: isLoggedInFromConfig,
            finalResult: isLoggedIn
        });

        return isLoggedIn;
    }

    // ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸
    function redirectToLogin() {
        console.log('ğŸ” ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™');

        const currentUrl = window.location.href;
        localStorage.setItem('pendingRedirect', currentUrl);

        const loginUrl = `/mobile/login?redirect=${encodeURIComponent(currentUrl)}`;
        window.location.href = loginUrl;
    }

    // ì˜ìƒí†µí™” í˜ì´ì§€ë¡œ ì´ë™ (ë¡œê·¸ì¸ ì²´í¬ í¬í•¨)
    function goToVideoCall() {
        console.log('ğŸ¬ ì˜ìƒí†µí™” ë²„íŠ¼ í´ë¦­');

        if (!checkLoginStatus()) {
            alert('ì˜ìƒí†µí™” ê¸°ëŠ¥ì„ ì´ìš©í•˜ë ¤ë©´ ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤.');
            redirectToLogin();
            return;
        }

        console.log('âœ… ë¡œê·¸ì¸ ìƒíƒœ í™•ì¸ë¨. ì˜ìƒí†µí™” í˜ì´ì§€ë¡œ ì´ë™');

        localStorage.setItem('selectedContactKey', contactKey);
        localStorage.setItem('selectedContactName', contactName);
        window.location.href = `/mobile/video-call?contact=${contactKey}`;
    }

    // ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
    function goToMainScreen() {
        window.location.href = '/mobile/home';
    }

</script>
</body>
</html>