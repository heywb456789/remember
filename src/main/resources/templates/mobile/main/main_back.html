<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{mobile/layout/default :: html(
        ~{::title},
        ~{::section},
        ~{::customCSS},
        ~{::customJS},
        'main',
        'dashboard'
      )}">
<head>
  <title>ë©”ì¸ - í† ë§ˆí† ë¦¬ë©¤ë²„</title>

  <!-- Custom CSS -->
  <customCSS>
    <link th:href="@{/assets/mobile/css/main.css}" rel="stylesheet">
    <style>
      /* ë©”ëª¨ë¦¬ì–¼ ì„ íƒ ê´€ë ¨ ìŠ¤íƒ€ì¼ - ê¸°ì¡´ ìŠ¤íƒ€ì¼ ìœ ì§€í•˜ë©´ì„œ ì¶”ê°€ */
      .memorial-item.selected {
        border: 2px solid #ff6b6b !important;
        background: #fff5f5 !important;
        box-shadow: 0 4px 16px rgba(255, 107, 107, 0.3) !important;
      }

      .memorial-item.selected::before {
        content: '';
        position: absolute;
        top: -2px;
        left: -2px;
        right: -2px;
        bottom: -2px;
        background: linear-gradient(45deg, #ff6b6b, #ff8e8e);
        border-radius: var(--radius-md);
        z-index: -1;
      }

      /* í™”ì‚´í‘œ ì˜ì—­ì— ì„ íƒ ì•„ì´ì½˜ ì¶”ê°€ */
      .memorial-arrow {
        position: relative;
        display: flex !important;
        align-items: center;
        justify-content: center;
        width: 24px;
        height: 24px;
      }

      .selection-icon {
        color: #ff6b6b;
        font-size: 20px;
        display: none;
      }

      .memorial-item.selected .selection-icon {
        display: block !important;
      }

      .memorial-item.selected .memorial-arrow i.fas.fa-chevron-right {
        display: none;
      }

      /* ë©”ëª¨ë¦¬ì–¼ ì„ íƒ ì•ˆë‚´ */
      .memorial-selection-guide {
        text-align: center;
        margin-bottom: 16px;
        padding: 12px;
        background: #e3f2fd;
        border-radius: 8px;
        color: #1976d2;
        font-size: 14px;
        display: none;
      }

      .memorial-selection-guide.show {
        display: block;
      }

      .memorial-selection-guide i {
        margin-right: 8px;
      }

      /* ìƒíƒœ í‘œì‹œ ì•„ì´ì½˜ */
      .memorial-status {
        display: flex;
        align-items: center;
        gap: 8px;
      }

      .status-indicators {
        display: flex;
        gap: 4px;
      }

      .status-icon {
        font-size: 12px;
        opacity: 0.7;
      }

      .status-icon.status-ok {
        color: #28a745;
      }

      .status-icon.status-warning {
        color: #ffc107;
      }

      /* ë©”ëª¨ë¦¬ì–¼ ë©”íƒ€ ì •ë³´ */
      .memorial-meta {
        font-size: 12px;
        color: var(--text-light);
        margin-top: 4px;
        display: flex;
        align-items: center;
        gap: 4px;
      }

      .memorial-meta .separator {
        opacity: 0.5;
      }

      /* ë°˜ì‘í˜• ê°œì„  */
      @media (max-width: 768px) {
        .status-icon {
          font-size: 11px;
        }

        .selection-icon {
          font-size: 18px;
        }
      }
    </style>
  </customCSS>
</head>
<body>
<section>
  <div class="container">
    <!-- í™˜ì˜ ë©”ì‹œì§€ -->
    <div class="welcome-message" th:if="${!isLoggedIn or memorialCount == 0}">
      <div class="welcome-text">'í† ë§ˆí† ë¦¬ë©¤ë²„'ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤.</div>
      <div class="welcome-subtitle">ì†Œì¤‘í•œ ë¶„ê³¼ì˜ ì˜ì›í•œ ì¶”ì–µì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.</div>
    </div>

    <!-- ë¡œê·¸ì¸ ì „ - ë””ì§€í„¸ ì¶”ëª¨ ê³µê°„ ì¹´ë“œ -->
    <div class="logged-out-only" th:if="${!isLoggedIn}">
      <div class="memorial-intro-card">
        <div class="memorial-intro-icon">
          <i class="fas fa-heart"></i>
        </div>
        <div class="memorial-intro-title">ë””ì§€í„¸ ì¶”ëª¨ ê³µê°„</div>
        <div class="memorial-intro-subtitle">
          ë¸”ë¡ì²´ì¸ ê¸°ìˆ ë¡œ ì•ˆì „í•˜ê²Œ ë³´ê´€ë˜ëŠ”<br>
          ì˜ì›í•œ ì¶”ëª¨ ê³µê°„ì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.
        </div>
        <!-- ìƒˆ ë©”ëª¨ë¦¬ì–¼ ë“±ë¡ ë²„íŠ¼ -->
        <button class="new-memorial-btn" type="button">
          <i class="fas fa-plus"></i>
          ìƒˆ ë©”ëª¨ë¦¬ì–¼ ë“±ë¡í•˜ê¸°
        </button>
      </div>

      <!-- ì„œë¹„ìŠ¤ ì•ˆë‚´ -->
      <div class="service-intro">
        <div class="service-title">
          <i class="fas fa-shield-alt"></i>
          ì•ˆì „í•˜ê³  íˆ¬ëª…í•œ ì„œë¹„ìŠ¤
        </div>
      </div>

      <!-- ì¶”ê°€ ì„œë¹„ìŠ¤ ì¹´ë“œë“¤ -->
      <div class="additional-services">
        <!-- ë¸”ë¡ì²´ì¸ í† í° ì‹œìŠ¤í…œ -->
        <div class="service-card">
          <div class="service-card-header">
            <div class="service-card-icon blockchain">
              <i class="fas fa-coins"></i>
            </div>
            <h4 class="service-card-title">ë¸”ë¡ì²´ì¸ í† í° ì‹œìŠ¤í…œ</h4>
          </div>
          <p class="service-card-description">íˆ¬ëª…í•˜ê³  ê³µì •í•œ ì„œë¹„ìŠ¤ ì´ìš©</p>
        </div>

        <!-- ì˜êµ¬ ë³´ê´€ -->
        <div class="service-card">
          <div class="service-card-header">
            <div class="service-card-icon storage">
              <i class="fas fa-archive"></i>
            </div>
            <h4 class="service-card-title">ì˜êµ¬ ë³´ê´€</h4>
          </div>
          <p class="service-card-description">ì†Œì¤‘í•œ ì¶”ì–µì„ ì˜ì›íˆ ì•ˆì „í•˜ê²Œ ë³´ê´€</p>
        </div>

        <!-- ê°€ì¡± ê³µìœ  -->
        <div class="service-card">
          <div class="service-card-header">
            <div class="service-card-icon family">
              <i class="fas fa-users"></i>
            </div>
            <h4 class="service-card-title">ê°€ì¡± ê³µìœ </h4>
          </div>
          <p class="service-card-description">ê°€ì¡± êµ¬ì„±ì›ê³¼ í•¨ê»˜ ì¶”ì–µ ê³µìœ </p>
        </div>
      </div>

      <!-- 3ê°œì›” ë¬´ë£Œì²´í—˜ ì‹œì‘í•˜ê¸° -->
      <div class="free-trial-section">
        <button class="free-trial-btn" type="button">
          <i class="fas fa-play"></i>
          3ê°œì›” ë¬´ë£Œì²´í—˜ ì‹œì‘í•˜ê¸°
        </button>
      </div>

      <!-- ì•½ê´€ ë° í‘¸í„° ì˜ì—­ -->
      <div class="terms-footer-section">
        <div class="terms-links">
          <a href="/mobile/terms/service" class="terms-link">
            <i class="fas fa-file-alt"></i>
            ì´ìš©ì•½ê´€
          </a>
          <a href="/mobile/terms/privacy" class="terms-link">
            <i class="fas fa-shield-alt"></i>
            ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨
          </a>
          <a href="/mobile/support/contact" class="terms-link">
            <i class="fas fa-phone"></i>
            ê³ ê°ì§€ì›
          </a>
        </div>

        <div class="footer-info">
          <div class="company-info">
            ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì–‘í™”ì§„ 4ê¸¸ 32 ì´í† ë§ˆí† ë¹Œë”© 2ì¸µ<br>
            ì‚¬ì—…ìë“±ë¡ë²ˆí˜¸ 123-45-67890 | ëŒ€í‘œ ê¹€í† ë§ˆí† 
          </div>
          <div class="contact-info">
            ì „í™”ë²ˆí˜¸: 02-2128-3838 | ì´ë©”ì¼: tomatoai@etomato.com
          </div>
          <div class="copyright">
            COPYRIGHT Â© 2025 TOMATOREMEMBER. ALL RIGHTS RESERVED.
          </div>
        </div>
      </div>
    </div>

    <!-- ë¡œê·¸ì¸ í›„ - ë©”ëª¨ë¦¬ì–¼ ê´€ë¦¬ -->
    <div class="logged-in-only" th:if="${isLoggedIn}">
      <!-- ìƒˆ ë©”ëª¨ë¦¬ì–¼ ë“±ë¡ ë²„íŠ¼ -->
      <div class="add-memorial-section">
        <button class="add-memorial-btn" type="button">
          <i class="fas fa-user-plus"></i>
          ìƒˆ ë©”ëª¨ë¦¬ì–¼ ë“±ë¡í•˜ê¸°
        </button>
      </div>

      <!-- ë“±ë¡ëœ ë©”ëª¨ë¦¬ì–¼ì´ ìˆëŠ” ê²½ìš° -->
      <div class="memorial-list-section" th:if="${memorialCount > 0}">
        <!-- ë©”ëª¨ë¦¬ì–¼ ì„ íƒ ì•ˆë‚´ (ë³µìˆ˜ ë©”ëª¨ë¦¬ì–¼ì¸ ê²½ìš°ë§Œ) -->
        <div class="memorial-selection-guide" th:if="${memorialCount > 1}">
          <i class="fas fa-info-circle"></i>
          ì˜ìƒí†µí™”í•  ë©”ëª¨ë¦¬ì–¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.
        </div>

        <!-- ë©”ëª¨ë¦¬ì–¼ ë¦¬ìŠ¤íŠ¸ ì»¨í…Œì´ë„ˆ -->
        <div class="memorial-list-container">
          <div id="memorialList" class="memorial-list">
            <!-- ë©”ëª¨ë¦¬ì–¼ ì•„ì´í…œ í…œí”Œë¦¿ -->
            <div class="memorial-item" th:each="memorial, iterStat : ${memorialList}"
                 th:data-memorial-id="${memorial.memorialId}">

              <!-- ë©”ëª¨ë¦¬ì–¼ ì•„ë°”íƒ€ -->
              <div class="memorial-avatar">
                <!-- í”„ë¡œí•„ ì´ë¯¸ì§€ê°€ ì—†ëŠ” ê²½ìš° ê´€ê³„ë³„ ì´ëª¨ì§€ -->
                <span class="memorial-emoji" th:switch="${memorial.relationshipDescription}">

                  <!-- ë¶€ëª¨ë‹˜ ê´€ê³„ -->
                  <span th:case="'ë¶€'" class="emoji">ğŸ‘¨</span>
                  <span th:case="'ëª¨'" class="emoji">ğŸ‘©</span>
                  <span th:case="'ë°°ìš°ìë¶€'" class="emoji">ğŸ‘¨</span>
                  <span th:case="'ë°°ìš°ìëª¨'" class="emoji">ğŸ‘©</span>

                  <!-- ì¡°ë¶€ëª¨ë‹˜ ê´€ê³„ -->
                  <span th:case="'ì¡°ë¶€'" class="emoji">ğŸ‘´</span>
                  <span th:case="'ì¡°ëª¨'" class="emoji">ğŸ‘µ</span>
                  <span th:case="'ì¦ì¡°ë¶€'" class="emoji">ğŸ‘´</span>
                  <span th:case="'ì¦ì¡°ëª¨'" class="emoji">ğŸ‘µ</span>

                  <!-- ë°°ìš°ì ê´€ê³„ -->
                  <span th:case="'ë°°ìš°ì'" class="emoji">ğŸ’‘</span>

                  <!-- ìë…€ ê´€ê³„ -->
                  <span th:case="'ì'" class="emoji">ğŸ‘¶</span>
                  <span th:case="'ìë¶€'" class="emoji">ğŸ‘°</span>
                  <span th:case="'ì‚¬ìœ„'" class="emoji">ğŸ¤µ</span>

                  <!-- í˜•ì œ/ìë§¤ ê´€ê³„ -->
                  <span th:case="'í˜•ì œ/ìë§¤'" class="emoji">ğŸ‘«</span>

                  <!-- ì†ì/ì¦ì† ê´€ê³„ -->
                  <span th:case="'ì†'" class="emoji">ğŸ‘¶</span>
                  <span th:case="'ì¦ì†'" class="emoji">ğŸ‘¶</span>

                  <!-- ë³¸ì¸ -->
                  <span th:case="'ë³¸ì¸'" class="emoji">ğŸ˜Š</span>

                  <!-- ë™ê±°ì¸ -->
                  <span th:case="'ë™ê±°ì¸'" class="emoji">ğŸ </span>

                  <!-- ê¸°íƒ€ ë˜ëŠ” ê¸°ë³¸ê°’ -->
                  <span th:case="*" class="emoji">ğŸ‘¤</span>
                </span>
              </div>

              <!-- ë©”ëª¨ë¦¬ì–¼ ì •ë³´ -->
              <div class="memorial-info">
                <div class="memorial-name" th:text="${memorial.name}">ê¹€ìˆœì</div>
                <div class="memorial-relationship" th:text="${memorial.relationshipDescription ?: 'ê´€ê³„ ì—†ìŒ'}">í• ë¨¸ë‹ˆ</div>
              </div>

              <!-- í™”ì‚´í‘œ ì•„ì´ì½˜ -->
              <div class="memorial-arrow">
                <i class="fas fa-chevron-right"></i>
                <i class="fas fa-check-circle selection-icon" style="display: none;"></i>
              </div>
            </div>
          </div>

          <!-- ë”ë³´ê¸° ì•ˆë‚´ í…ìŠ¤íŠ¸ (5ê°œ ì´ˆê³¼ ì‹œ) -->
          <div class="more-info" th:if="${hasMoreMemorials}">
            <i class="fas fa-info-circle"></i>
            ë©”ëª¨ë¦¬ì–¼ì„ íƒ­í•˜ì—¬ ì„ íƒí•˜ê³  ì˜ìƒí†µí™”ë¥¼ ì‹œì‘í•˜ì„¸ìš”.
          </div>
        </div>
      </div>

      <!-- ë“±ë¡ëœ ë©”ëª¨ë¦¬ì–¼ì´ ì—†ëŠ” ê²½ìš° -->
      <div class="empty-state" th:if="${memorialCount == 0}">
        <div class="empty-icon">
          <i class="fas fa-heart"></i>
        </div>
        <h3>ë“±ë¡ëœ ë©”ëª¨ë¦¬ì–¼ì´ ì—†ìŠµë‹ˆë‹¤.</h3>
        <p>ì†Œì¤‘í•œ ë¶„ê³¼ì˜ ì˜ì›í•œ ì¶”ì–µì„ ë§Œë“¤ì–´ë³´ì„¸ìš”.</p>
        <button class="btn empty-state-create-btn" type="button">
          <i class="fas fa-plus"></i>
          ìƒˆ ë©”ëª¨ë¦¬ì–¼ ë“±ë¡í•˜ê¸°
        </button>
      </div>

      <!-- í•˜ë‹¨ ì˜ìƒí†µí™” ë²„íŠ¼ -->
      <div class="bottom-actions">
        <button class="video-call-btn" type="button" th:disabled="${memorialCount == 0}">
          <i class="fas fa-video"></i>
          ì˜ìƒí†µí™”
        </button>
      </div>
    </div>

    <!-- ë¡œë”© ìŠ¤ì¼ˆë ˆí†¤ -->
    <div class="loading-skeleton" id="loadingSkeleton" style="display: none;">
      <div class="skeleton-item">
        <div class="skeleton-avatar"></div>
        <div class="skeleton-content">
          <div class="skeleton-line"></div>
          <div class="skeleton-line short"></div>
        </div>
      </div>
      <div class="skeleton-item">
        <div class="skeleton-avatar"></div>
        <div class="skeleton-content">
          <div class="skeleton-line"></div>
          <div class="skeleton-line short"></div>
        </div>
      </div>
      <div class="skeleton-item">
        <div class="skeleton-avatar"></div>
        <div class="skeleton-content">
          <div class="skeleton-line"></div>
          <div class="skeleton-line short"></div>
        </div>
      </div>
    </div>

    <!-- ì—ëŸ¬ ìƒíƒœ -->
    <div class="error-state" id="errorState" style="display: none;">
      <div class="error-icon">
        <i class="fas fa-exclamation-triangle"></i>
      </div>
      <h4>ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤</h4>
      <p id="errorMessage">ë©”ëª¨ë¦¬ì–¼ ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.</p>
      <button class="btn retry-btn" type="button">
        <i class="fas fa-refresh"></i>
        ë‹¤ì‹œ ì‹œë„
      </button>
    </div>
  </div>
</section>

<!-- Custom JavaScript -->
<customJS>
  <!-- ì„œë²„ ì‚¬ì´ë“œ ë°ì´í„° ì „ë‹¬ -->
  <script th:inline="javascript">
    // ì„œë²„ì—ì„œ ì „ë‹¬ë°›ì€ ë°ì´í„°
    window.serverData = {
      isLoggedIn: /*[[${isLoggedIn}]]*/ false,
      memorialCount: /*[[${memorialCount}]]*/ 0,
      memorialList: /*[[${memorialList}]]*/ [],
      currentUser: /*[[${currentUser}]]*/ null,
      hasMoreMemorials: /*[[${hasMoreMemorials}]]*/ false,
      showTrialBanner: /*[[${showTrialBanner}]]*/ false,
      trialDaysRemaining: /*[[${trialDaysRemaining}]]*/ 0,
      freeTrialMonths: /*[[${freeTrialMonths}]]*/ 3,
      maxFamilyMembers: /*[[${maxFamilyMembers}]]*/ 8,
      urls: {
        login: /*[[${loginUrl}]]*/ '/mobile/login',
        register: /*[[${registerUrl}]]*/ '/mobile/register',
        memorialCreate: /*[[${memorialCreateUrl}]]*/ '/mobile/memorial/create',
        payment: /*[[${paymentUrl}]]*/ '/mobile/payment',
        videocall: /*[[${videocallUrl}]]*/ '/mobile/videocall'
      }
    };

    // ë©”ëª¨ë¦¬ì–¼ì´ ì—¬ëŸ¬ê°œì¸ ê²½ìš° ì„ íƒ ì•ˆë‚´ í‘œì‹œ
    if (window.serverData.memorialCount > 1) {
      document.addEventListener('DOMContentLoaded', function() {
        const guide = document.querySelector('.memorial-selection-guide');
        if (guide) {
          guide.classList.add('show');
        }
      });
    }

    // ê°œë°œ ëª¨ë“œ í™œì„±í™”
    if (window.location.search.includes('debug=true')) {
      window.debugMode = true;
      console.log('ë©”ì¸ í˜ì´ì§€ ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”');
      console.log('ì„œë²„ ë°ì´í„°:', window.serverData);
    }
  </script>

  <!-- ë©”ì¸ í˜ì´ì§€ JavaScript ë¡œë“œ -->
  <script th:src="@{/assets/mobile/js/main.js}" type="module"></script>
</customJS>
</body>
</html>