<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:fragment="html(title, content, customCSS, customJS, activeMenu, activeSubMenu)">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
  <meta name="format-detection" content="telephone=no"/>
  <meta name="mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"/>
  <meta name="theme-color" content="#ff6b35"/>

  <title th:replace="${title}">í† ë§ˆí† ë¦¬ë©¤ë²„</title>

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/favicon.ico"/>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"/>

  <!-- Google Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Bootstrap CSS -->
  <link th:href="@{/bootstrap/css/bootstrap.css}" rel="stylesheet"/>

  <!-- Common CSS -->
  <link th:href="@{/assets/mobile/css/common.css}" rel="stylesheet"/>
  <link th:href="@{/assets/mobile/css/layout.css}" rel="stylesheet"/>
  <link th:href="@{/assets/mobile/css/tomatoGroup.css}" rel="stylesheet"/>
  <link th:href="@{/assets/mobile/css/tomatoModal.css}" rel="stylesheet"/>

  <!-- Custom CSS -->
  <th:block th:replace="${customCSS}"></th:block>
</head>
<body class="mobile-layout" th:classappend="|page-${activeMenu ?: 'main'}|">

<!-- PC ì „ìš© ì‚¬ì´ë“œë°” -->
<aside class="pc-sidebar">
  <div class="sidebar-header">
    <a href="/mobile/home" class="sidebar-logo">TOMATOREMEMBER</a>
  </div>
  <nav class="sidebar-nav">
    <ul class="sidebar-menu">
      <li class="sidebar-menu-item">
        <a href="/mobile/home"
           class="sidebar-menu-link"
           th:classappend="${(activeMenu ?: 'main') == 'main' ? 'active' : ''}">
          <i class="fas fa-home sidebar-menu-icon"></i>
          <span>í™ˆ</span>
        </a>
      </li>
      <li class="sidebar-menu-item" th:if="${currentUser != null}">
        <a href="/mobile/account/profile"
           class="sidebar-menu-link"
           th:classappend="${(activeMenu ?: 'main') == 'profile' ? 'active' : ''}">
          <i class="fas fa-user sidebar-menu-icon"></i>
          <span>í”„ë¡œí•„ ì„¤ì •</span>
        </a>
      </li>
      <li class="sidebar-menu-item" th:if="${currentUser != null}">
        <a href="/mobile/family"
           class="sidebar-menu-link"
           th:classappend="${(activeMenu ?: 'main') == 'family' ? 'active' : ''}">
          <i class="fas fa-users sidebar-menu-icon"></i>
          <span>ê°€ì¡± ê´€ë¦¬</span>
        </a>
      </li>
      <li class="sidebar-menu-item" th:if="${currentUser != null}">
        <a href="/mobile/account/settings"
           class="sidebar-menu-link disabled">
          <i class="fas fa-cog sidebar-menu-icon"></i>
          <span>ì„¤ì •</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="/mobile/support/faq"
           class="sidebar-menu-link disabled">
          <i class="fas fa-question-circle sidebar-menu-icon"></i>
          <span>ë„ì›€ë§</span>
        </a>
      </li>
      <li class="sidebar-menu-item">
        <a href="/mobile/support/contact"
           class="sidebar-menu-link disabled">
          <i class="fas fa-phone sidebar-menu-icon"></i>
          <span>ê³ ê°ì§€ì›</span>
        </a>
      </li>
      <li class="sidebar-menu-item" th:unless="${currentUser != null}">
        <a href="/mobile/login"
           class="sidebar-menu-link">
          <i class="fas fa-sign-in-alt sidebar-menu-icon"></i>
          <span>ë¡œê·¸ì¸</span>
        </a>
      </li>
      <li class="sidebar-menu-item" th:unless="${currentUser != null}">
        <a href="/mobile/register"
           class="sidebar-menu-link">
          <i class="fas fa-user-plus sidebar-menu-icon"></i>
          <span>íšŒì›ê°€ì…</span>
        </a>
      </li>
      <li class="sidebar-menu-item" th:if="${currentUser != null}">
        <button class="sidebar-menu-link logout-btn"
                style="border: none; background: none; width: 100%; text-align: left;"
                onclick="logout()">
          <i class="fas fa-sign-out-alt sidebar-menu-icon"></i>
          <span>ë¡œê·¸ì•„ì›ƒ</span>
        </button>
      </li>
    </ul>
  </nav>
</aside>

<!-- í—¤ë” -->
<header class="mobile-header fixed-top" id="mobileHeader">
  <div class="container-fluid">
    <div class="header-content">
      <!-- ë¡œê³  -->
      <div class="header-logo">
        <a href="/mobile/home" class="logo-link" aria-label="í† ë§ˆí† ë¦¬ë©¤ë²„ í™ˆìœ¼ë¡œ ì´ë™">
          <span class="logo-text">TOMATOREMEMBER</span>
        </a>
      </div>

      <!-- ì‚¬ìš©ì ì •ë³´ (PC ì „ìš©) -->
      <div class="header-user-info d-none d-lg-flex align-items-center" th:if="${currentUser != null}">
        <span class="user-greeting me-3" th:text="|ì•ˆë…•í•˜ì„¸ìš”, ${currentUser.name}ë‹˜|">ì•ˆë…•í•˜ì„¸ìš”, ì‚¬ìš©ìë‹˜</span>
        <img th:src="${currentUser.profileImageUrl ?: '/assets/mobile/images/default-avatar.png'}"
             th:alt="${currentUser.name}"
             class="user-avatar-small rounded-circle"
             style="width: 32px; height: 32px;">
      </div>

      <!-- í–„ë²„ê±° ë©”ë‰´ ë²„íŠ¼ (ëª¨ë°”ì¼ ì „ìš©) -->
      <button class="header-menu-btn d-lg-none" type="button" id="menuToggleBtn" aria-label="ë©”ë‰´ ì—´ê¸°">
          <span class="menu-icon">
            <span></span>
            <span></span>
            <span></span>
          </span>
      </button>
    </div>
  </div>
</header>

<!-- ë©”ì¸ ì½˜í…ì¸  -->
<main class="mobile-main" id="mobileMain">
  <div th:replace="${content}"></div>
</main>

<!-- í•˜ë‹¨ ì•± ë„¤ë¹„ê²Œì´ì…˜ë§Œ ìœ ì§€ -->
<!--<nav class="mobile-app-nav" id="mobileAppNav">-->
<!--  <div class="app-nav-container">-->
<!--    &lt;!&ndash; ë¡œë”© ìƒíƒœ &ndash;&gt;-->
<!--    <div class="app-nav-loading" id="appNavLoading">-->
<!--      <div class="loading-spinner"></div>-->
<!--      <span>ì•± ëª©ë¡ ë¡œë”©ì¤‘...</span>-->
<!--    </div>-->

<!--    &lt;!&ndash; ì•± ëª©ë¡ ì»¨í…Œì´ë„ˆ &ndash;&gt;-->
<!--    <div class="app-nav-scroll" id="appNavScroll" style="display: none;">-->
<!--      &lt;!&ndash; JavaScriptë¡œ ë™ì  ìƒì„± &ndash;&gt;-->
<!--    </div>-->

<!--    &lt;!&ndash; ì—ëŸ¬ ìƒíƒœ &ndash;&gt;-->
<!--    <div class="app-nav-error" id="appNavError" style="display: none;">-->
<!--      <span>ì•± ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</span>-->
<!--      <button class="retry-btn" onclick="window.initializeAppNavigation()">ì¬ì‹œë„</button>-->
<!--    </div>-->

<!--    &lt;!&ndash; ìŠ¤í¬ë¡¤ ì¸ë””ì¼€ì´í„° &ndash;&gt;-->
<!--    <div class="scroll-indicator" id="scrollIndicator" style="display: none;">-->
<!--      <div class="scroll-indicator-bar" id="scrollIndicatorBar"></div>-->
<!--    </div>-->
<!--  </div>-->
<!--</nav>-->

<!-- ğŸ”§ FAB ë²„íŠ¼ë“¤ì€ í…œí”Œë¦¿ì—ì„œ ì œê±°í•˜ê³  JavaScriptë¡œ ë™ì  ìƒì„± -->
<!-- ì²´í—˜í•˜ê¸° FAB: main.jsì—ì„œ ìƒì„± (ìš°ì„ ìˆœìœ„) -->
<!-- ì±„íŒ… FAB: layout.jsì—ì„œ ìƒì„± (ì²´í—˜í•˜ê¸° ì•„ë˜) -->

<!-- í–„ë²„ê±° ë©”ë‰´ ì˜¤ë²„ë ˆì´ (ëª¨ë°”ì¼ ì „ìš©) -->
<div class="menu-overlay d-lg-none" id="menuOverlay"></div>

<!-- ì‚¬ì´ë“œ ë©”ë‰´ (Offcanvas) - ëª¨ë°”ì¼ ì „ìš© -->
<div class="mobile-offcanvas d-lg-none" tabindex="-1" id="mobileMenu" aria-labelledby="mobileMenuLabel">
  <div class="offcanvas-header">
    <div class="offcanvas-title" id="mobileMenuLabel">
      <!-- ë¡œê·¸ì¸ í›„ ì‚¬ìš©ì ì •ë³´ -->
      <div class="user-info" th:if="${currentUser != null}">
        <div class="user-avatar">
          <img th:src="${currentUser.profileImageUrl ?: '/assets/mobile/images/default-avatar.png'}"
               th:alt="${currentUser.name}" class="avatar-img">
        </div>
        <div class="user-details">
          <h6 class="user-name" th:text="${currentUser.name ?: 'ì‚¬ìš©ì'}">ê¹€í† ë§ˆí† </h6>
          <p class="user-email" th:text="${currentUser.email ?: currentUser.phoneNumber ?: ''}">tomato@example.com</p>
        </div>
      </div>

      <!-- ë¡œê·¸ì¸ ì „ ê²ŒìŠ¤íŠ¸ ì •ë³´ -->
      <div class="guest-info" th:unless="${currentUser != null}">
        <div class="guest-avatar">
          <span class="emoji-icon">ğŸ‘¤</span>
        </div>
        <div class="guest-details">
          <h6>ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤</h6>
          <a href="/mobile/login" class="btn btn-sm btn-primary">ë¡œê·¸ì¸</a>
        </div>
      </div>
    </div>

    <button type="button" class="btn-close" id="menuCloseBtn" aria-label="ë©”ë‰´ ë‹«ê¸°"></button>
  </div>

  <div class="offcanvas-body">
    <!-- ë¡œê·¸ì¸ í›„ ë©”ë‰´ -->
    <div class="menu-section" th:if="${currentUser != null}">
      <ul class="menu-list">
        <li>
          <a href="/mobile/account/profile" class="menu-link">
            <span class="emoji-icon">ğŸ‘¤</span>
            <div class="menu-content">
              <span class="menu-text">í”„ë¡œí•„ ì„¤ì •</span>
              <small class="menu-desc">ê°œì¸ì •ë³´ ë° ê³„ì • ê´€ë¦¬</small>
            </div>
          </a>
        </li>
        <li>
          <a href="/mobile/family" class="menu-link">
            <span class="emoji-icon">ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦</span>
            <div class="menu-content">
              <span class="menu-text">ê°€ì¡± ê´€ë¦¬</span>
              <small class="menu-desc">ê°€ì¡± ì´ˆëŒ€ ë° ê¶Œí•œ ê´€ë¦¬</small>
            </div>
          </a>
        </li>
        <li>
          <a href="/mobile/account/settings" class="menu-link disabled">
            <span class="emoji-icon">âš™ï¸</span>
            <div class="menu-content">
              <span class="menu-text">ì„¤ì •</span>
              <small class="menu-desc">ì•Œë¦¼, ë³´ì•ˆ ë° ì•± ì„¤ì •</small>
            </div>
          </a>
        </li>
        <li>
          <a href="/mobile/support/faq" class="menu-link disabled">
            <span class="emoji-icon">â“</span>
            <div class="menu-content">
              <span class="menu-text">ë„ì›€ë§</span>
              <small class="menu-desc">ì‚¬ìš©ë²• ë° ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</small>
            </div>
          </a>
        </li>
        <li>
          <a href="/mobile/support/contact" class="menu-link disabled">
            <span class="emoji-icon">ğŸ“</span>
            <div class="menu-content">
              <span class="menu-text">ê³ ê°ì§€ì›</span>
              <small class="menu-desc">ë¬¸ì˜ì‚¬í•­ ë° ê¸°ìˆ ì§€ì›</small>
            </div>
          </a>
        </li>
        <li>
          <button class="menu-link logout-btn" onclick="logout()">
            <span class="emoji-icon">ğŸšª</span>
            <div class="menu-content">
              <span class="menu-text">ë¡œê·¸ì•„ì›ƒ</span>
              <small class="menu-desc">ì•ˆì „í•˜ê²Œ ë¡œê·¸ì•„ì›ƒí•˜ê¸°</small>
            </div>
          </button>
        </li>
      </ul>
    </div>

    <!-- ë¡œê·¸ì¸ ì „ ë©”ë‰´ -->
    <div class="menu-section" th:unless="${currentUser != null}">
      <h6 class="menu-title">ê³„ì •</h6>
      <ul class="menu-list">
        <li>
          <a href="/mobile/login" class="menu-link">
            <span class="emoji-icon">ğŸ”</span>
            <div class="menu-content">
              <span class="menu-text">ë¡œê·¸ì¸</span>
              <small class="menu-desc">ê¸°ì¡´ ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ê¸°</small>
            </div>
          </a>
        </li>
        <li>
          <a href="/mobile/register" class="menu-link">
            <span class="emoji-icon">ğŸŒ¸</span>
            <div class="menu-content">
              <span class="menu-text">íšŒì›ê°€ì…</span>
              <small class="menu-desc">ìƒˆ ê³„ì • ë§Œë“¤ê³  ì‹œì‘í•˜ê¸°</small>
            </div>
          </a>
        </li>
      </ul>

      <h6 class="menu-title">ì •ë³´</h6>
      <ul class="menu-list">
        <li>
          <a href="/mobile/support/faq" class="menu-link disabled">
            <span class="emoji-icon">â“</span>
            <div class="menu-content">
              <span class="menu-text">ë„ì›€ë§</span>
              <small class="menu-desc">ì‚¬ìš©ë²• ë° ìì£¼ ë¬»ëŠ” ì§ˆë¬¸</small>
            </div>
          </a>
        </li>
        <li>
          <a href="/mobile/support/contact" class="menu-link disabled">
            <span class="emoji-icon">ğŸ“</span>
            <div class="menu-content">
              <span class="menu-text">ê³ ê°ì§€ì›</span>
              <small class="menu-desc">ë¬¸ì˜ì‚¬í•­ ë° ê¸°ìˆ ì§€ì›</small>
            </div>
          </a>
        </li>
        <li>
          <a href="/mobile/legal/privacy" class="menu-link disabled">
            <span class="emoji-icon">ğŸ”’</span>
            <div class="menu-content">
              <span class="menu-text">ê°œì¸ì •ë³´ì²˜ë¦¬ë°©ì¹¨</span>
              <small class="menu-desc">ê°œì¸ì •ë³´ ë³´í˜¸ ì •ì±… í™•ì¸</small>
            </div>
          </a>
        </li>
      </ul>
    </div>

    <!-- í‘¸í„° ì •ë³´ -->
    <div class="menu-footer">
      <p class="company-info">
        ì„œìš¸íŠ¹ë³„ì‹œ ë§ˆí¬êµ¬ ì–‘í™”ì§„ 4ê¸¸ 32 ì´í† ë§ˆí† ë¹Œë”© 2ì¸µ<br>
        ì „í™”ë²ˆí˜¸: 02-2128-3838<br>
        ì´ë©”ì¼: tomatoai@etomato.com
      </p>
      <p class="copyright">
        COPYRIGHT Â© 2025 TOMATOREMEMBER.<br>
        ALL RIGHTS RESERVED.
      </p>
    </div>
  </div>
</div>

<!-- Bootstrap JS -->
<script th:src="@{/bootstrap/js/bootstrap.bundle.js}"></script>

<!-- í† í° ë™ê¸°í™” ìŠ¤í¬ë¦½íŠ¸ -->
<div th:replace="~{fragments/token-sync :: tokenSync}"></div>

<!-- Common JS -->
<script th:src="@{/assets/mobile/js/common.js}" type="module"></script>
<script th:src="@{/assets/mobile/js/layout.js}" type="module"></script>
<script th:src="@{/assets/mobile/js/tomatoGroupNavigation.js}" type="module"></script>

<!-- Custom JS -->
<th:block th:replace="${customJS}"></th:block>

<!-- ì „ì—­ ì„¤ì • ìŠ¤í¬ë¦½íŠ¸ -->
<script>
  // ê¸°ë³¸ ì „ì—­ ì„¤ì •
  window.APP_CONFIG = {
    baseUrl: '',
    activeMenu: /*[[ ${activeMenu} ?: 'main' ]]*/ 'main',
    activeSubMenu: /*[[ ${activeSubMenu} ?: null ]]*/ null,
    currentUser: /*[[ ${currentUser} ?: null ]]*/ null,
    isLoggedIn: /*[[ ${currentUser != null} ]]*/ false,

    // ë°˜ì‘í˜• ì„¤ì • ì¶”ê°€
    breakpoints: {
      mobile: 768,
      tablet: 1024,
      desktop: 1200
    },

    // ë””ë°”ì´ìŠ¤ íƒ€ì… ì²´í¬
    getDeviceType: function() {
      const width = window.innerWidth;
      if (width < this.breakpoints.mobile) return 'mobile';
      if (width < this.breakpoints.tablet) return 'tablet';
      return 'desktop';
    }
  };

  // API ì—”ë“œí¬ì¸íŠ¸ ì„¤ì •
  window.API_ENDPOINTS = {
    // ì¸ì¦ ê´€ë ¨
    LOGIN: '/api/auth/login',
    LOGOUT: '/api/auth/logout',
    REFRESH: '/api/auth/refresh',
    REGISTER: '/api/auth/register',

    // ê³„ì • ê´€ë¦¬
    USER_PROFILE: '/api/account/profile',
    FAMILY_MANAGEMENT: '/api/account/family',
    USER_SETTINGS: '/api/account/settings',

    // ì§€ì› ë° ê¸°íƒ€
    FAQ: '/api/support/faq',
    CONTACT: '/api/support/contact',

    // ê¸°ì¡´ ìœ ì§€
    MEMORIAL: '/api/memorial',
    VIDEO_CALL: '/api/video-call',
    TRIBUTE: '/api/tribute'
  };

  // ì „ì—­ ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ë“¤
  window.globalUtils = {
    // ë¡œê·¸ì•„ì›ƒ í•¨ìˆ˜
    logout: function() {
      if (confirm('ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
        // í† í° ì •ë¦¬
        localStorage.removeItem('accessToken');
        localStorage.removeItem('refreshToken');

        // ë¡œê·¸ì•„ì›ƒ í˜ì´ì§€ë¡œ ì´ë™ (ì„œë²„ì—ì„œ ì¿ í‚¤ ì •ë¦¬)
        window.location.href = '/mobile/logout';
      }
    },

    // ì±„íŒ… ì—´ê¸° í•¨ìˆ˜ (JavaScriptì—ì„œ ë™ì  ìƒì„±ëœ FABì—ì„œ í˜¸ì¶œ)
    openChat: function() {
      console.log('ğŸ’¬ ì±„íŒ… ì—´ê¸°');
      // TODO: ì±„íŒ… ê¸°ëŠ¥ êµ¬í˜„ í›„ ì£¼ì„ í•´ì œ
      alert('ì±„íŒ… ê¸°ëŠ¥ ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.');
    },

    // ë¡œê·¸ì¸ ëª¨ë‹¬ í‘œì‹œ
    showLoginModal: function() {
      alert('ì´ ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´\\në¨¼ì € ë¡œê·¸ì¸í•´ ì£¼ì„¸ìš”.');
      setTimeout(() => {
        window.location.href = '/mobile/login';
      }, 1000);
    },

    // í˜ì´ì§€ ë¡œë”© ìƒíƒœ í‘œì‹œ
    showPageLoading: function() {
      document.body.classList.add('loading');
    },

    // í˜ì´ì§€ ë¡œë”© ìƒíƒœ ìˆ¨ê¹€
    hidePageLoading: function() {
      document.body.classList.remove('loading');
    },

    // ë°˜ì‘í˜• ì²´í¬
    updateResponsiveLayout: function() {
      const deviceType = window.APP_CONFIG.getDeviceType();
      document.body.setAttribute('data-device', deviceType);

      // ë””ë°”ì´ìŠ¤ë³„ íŠ¹ë³„ ì²˜ë¦¬
      if (deviceType === 'desktop') {
        // PCì—ì„œ ëª¨ë°”ì¼ ë©”ë‰´ ê°•ì œ ë‹«ê¸°
        if (window.layoutManager && window.layoutManager.isMenuOpen()) {
          window.layoutManager.closeMenu();
        }
      }

      console.log('ğŸ“± ë””ë°”ì´ìŠ¤ íƒ€ì… ì—…ë°ì´íŠ¸:', deviceType);
    }
  };

  // ì „ì—­ í•¨ìˆ˜ë“¤ (í•˜ìœ„ í˜¸í™˜ì„±ì„ ìœ„í•´ ìœ ì§€)
  function logout() {
    window.globalUtils.logout();
  }

  function openChat() {
    window.globalUtils.openChat();
  }

  function showLoginModal() {
    window.globalUtils.showLoginModal();
  }

  // ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ì—…ë°ì´íŠ¸
  window.addEventListener('resize', window.globalUtils.updateResponsiveLayout);

  // í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ ì´ë²¤íŠ¸
  document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸ“± í† ë§ˆí† ë¦¬ë©¤ë²„ ì™„ì „ ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ë¡œë“œ ì™„ë£Œ (FAB JavaScript ê´€ë¦¬)');
    console.log('ğŸ‘¤ ë¡œê·¸ì¸ ìƒíƒœ:', window.APP_CONFIG.isLoggedIn);
    console.log('ğŸ“ í™œì„± ë©”ë‰´:', window.APP_CONFIG.activeMenu);
    console.log('ğŸ–¥ï¸ ë””ë°”ì´ìŠ¤ íƒ€ì…:', window.APP_CONFIG.getDeviceType());

    // ì´ˆê¸° ë°˜ì‘í˜• ë ˆì´ì•„ì›ƒ ì„¤ì •
    window.globalUtils.updateResponsiveLayout();

    // ğŸ”§ FAB ë²„íŠ¼ë“¤ì€ ì´ì œ ê°ê°ì˜ JavaScript íŒŒì¼ì—ì„œ ê´€ë¦¬
    console.log('ğŸš€ FAB ë²„íŠ¼ë“¤ì€ main.jsì™€ layout.jsì—ì„œ ê´€ë¦¬ë©ë‹ˆë‹¤.');
    console.log('   - ì²´í—˜í•˜ê¸° FAB: main.js (ìš°ì„ ìˆœìœ„, ìœ„ìª½)');
    console.log('   - ì±„íŒ… FAB: layout.js (ì²´í—˜í•˜ê¸° ì•„ë˜ìª½)');

    // í˜ì´ì§€ë³„ ì´ˆê¸°í™” ë¡œì§
    if (window.pageInitializer) {
      window.pageInitializer();
    }
  });

  // í˜ì´ì§€ ê°€ì‹œì„± ë³€ê²½ ê°ì§€
  document.addEventListener('visibilitychange', function() {
    if (!document.hidden) {
      console.log('ğŸ‘ï¸ í˜ì´ì§€ ê°€ì‹œì„± ë³µì›');

      // FAB ë²„íŠ¼ë“¤ ë³µêµ¬ëŠ” ê° JavaScript íŒŒì¼ì—ì„œ ì²˜ë¦¬
      if (window.layoutManager && window.layoutManager.initializeChatFab) {
        setTimeout(() => {
          const chatFab = document.querySelector('.chat-fab');
          if (!chatFab) {
            console.log('ğŸ’¬ í˜ì´ì§€ ë³µì› ì‹œ ì±„íŒ… FAB ì¬ìƒì„±');
            window.layoutManager.initializeChatFab();
          }
        }, 1000);
      }

      if (window.mainPageManager && window.mainPageManager.repositionFab) {
        setTimeout(() => {
          const experienceFab = document.querySelector('.experience-fab');
          if (!experienceFab && window.APP_CONFIG.isLoggedIn) {
            console.log('ğŸš€ í˜ì´ì§€ ë³µì› ì‹œ ì²´í—˜í•˜ê¸° FAB ì¬ìƒì„±');
            if (window.forceCreateExperienceFab) {
              window.forceCreateExperienceFab();
            }
          }
        }, 1000);
      }

      // í˜ì´ì§€ë³„ ìƒˆë¡œê³ ì¹¨ ë¡œì§
      if (window.pageRefresher) {
        window.pageRefresher();
      }
    }
  });

  // ì˜¨ë¼ì¸/ì˜¤í”„ë¼ì¸ ìƒíƒœ ê°ì§€
  window.addEventListener('online', function() {
    console.log('ğŸŒ ì˜¨ë¼ì¸ ìƒíƒœ ë³µì›');
    // ì˜¤í”„ë¼ì¸ ìƒíƒœ ì•Œë¦¼ ì œê±°
    const offlineAlert = document.querySelector('.offline-alert');
    if (offlineAlert) {
      offlineAlert.remove();
    }
  });

  window.addEventListener('offline', function() {
    console.log('ğŸ“´ ì˜¤í”„ë¼ì¸ ìƒíƒœ');
    // ì˜¤í”„ë¼ì¸ ìƒíƒœ ì•Œë¦¼ í‘œì‹œ
    if (!document.querySelector('.offline-alert')) {
      const alert = document.createElement('div');
      alert.className = 'offline-alert';
      alert.innerHTML = 'ì¸í„°ë„· ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.';
      alert.style.cssText = `
          position: fixed;
          top: ${window.APP_CONFIG.getDeviceType() === 'desktop' ? '80px' : '70px'};
          left: 50%;
          transform: translateX(-50%);
          background: #f56565;
          color: white;
          padding: 8px 16px;
          border-radius: 8px;
          font-size: 14px;
          z-index: 2000;
          animation: slideDown 0.3s ease;
        `;
      document.body.appendChild(alert);
    }
  });

  // í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì§€ì›
  document.addEventListener('keydown', function(e) {
    // ESC í‚¤ë¡œ ë©”ë‰´ ë‹«ê¸°
    if (e.key === 'Escape') {
      if (window.layoutManager && window.layoutManager.isMenuOpen) {
        window.layoutManager.closeMenu();
      }

      // ëª¨ë‹¬ì´ ì—´ë ¤ìˆìœ¼ë©´ ëª¨ë‹¬ ë‹«ê¸°
      const openModal = document.querySelector('.modal.show');
      if (openModal) {
        const closeBtn = openModal.querySelector('.btn-close');
        if (closeBtn) {
          closeBtn.click();
        }
      }

      // ì²´í—˜í•˜ê¸° í™•ì¥ ë©”ë‰´ ë‹«ê¸°
      if (window.mainPageManager && window.mainPageManager.closeExperience) {
        window.mainPageManager.closeExperience();
      }
    }
  });

  // disabled ë§í¬ ì²˜ë¦¬
  document.addEventListener('click', function(e) {
    if (e.target.closest('.disabled')) {
      e.preventDefault();
      if (window.showToast) {
        window.showToast('ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.', 'info', 2000);
      } else {
        alert('ì¤€ë¹„ ì¤‘ì¸ ê¸°ëŠ¥ì…ë‹ˆë‹¤.');
      }
    }
  });

  // ìœˆë„ìš° ë¦¬ì‚¬ì´ì¦ˆ ì‹œ FAB ë²„íŠ¼ë“¤ ìœ„ì¹˜ ì¬ì¡°ì •
  window.addEventListener('resize', function() {
    setTimeout(() => {
      // ì±„íŒ… FAB ìœ„ì¹˜ ì¬ì¡°ì •
      if (window.layoutManager && window.layoutManager.repositionChatFab) {
        window.layoutManager.repositionChatFab();
      }

      // ì²´í—˜í•˜ê¸° FAB ìœ„ì¹˜ ì¬ì¡°ì •
      if (window.mainPageManager && window.mainPageManager.repositionFab) {
        window.mainPageManager.repositionFab();
      }
    }, 300);
  });

  // ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”
  if (window.location.search.includes('debug=true')) {
    console.log('ğŸ”§ ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”');
    window.debugMode = true;

    // FAB ë²„íŠ¼ë“¤ ë””ë²„ê·¸ í•¨ìˆ˜
    window.debugFabButtons = function() {
      const chatFab = document.querySelector('.chat-fab');
      const experienceFab = document.querySelector('.experience-fab');

      console.group('ğŸ›ï¸ FAB ë²„íŠ¼ë“¤ ë””ë²„ê·¸ ì •ë³´');

      console.group('ğŸ’¬ ì±„íŒ… FAB');
      console.log('ìš”ì†Œ ì¡´ì¬:', !!chatFab);
      if (chatFab) {
        const computedStyle = getComputedStyle(chatFab);
        console.log('ìŠ¤íƒ€ì¼ ì •ë³´:', {
          display: computedStyle.display,
          visibility: computedStyle.visibility,
          opacity: computedStyle.opacity,
          position: computedStyle.position,
          bottom: computedStyle.bottom,
          right: computedStyle.right,
          zIndex: computedStyle.zIndex,
          width: computedStyle.width,
          height: computedStyle.height
        });
      }
      console.groupEnd();

      console.group('ğŸš€ ì²´í—˜í•˜ê¸° FAB');
      console.log('ìš”ì†Œ ì¡´ì¬:', !!experienceFab);
      if (experienceFab) {
        const computedStyle = getComputedStyle(experienceFab);
        console.log('ìŠ¤íƒ€ì¼ ì •ë³´:', {
          display: computedStyle.display,
          visibility: computedStyle.visibility,
          opacity: computedStyle.opacity,
          position: computedStyle.position,
          bottom: computedStyle.bottom,
          right: computedStyle.right,
          zIndex: computedStyle.zIndex,
          width: computedStyle.width,
          height: computedStyle.height
        });
      }
      console.groupEnd();

      console.log('ë¡œê·¸ì¸ ìƒíƒœ:', {
        'APP_CONFIG.isLoggedIn': window.APP_CONFIG?.isLoggedIn,
        'serverData.isLoggedIn': window.serverData?.isLoggedIn,
        'accessToken': !!localStorage.getItem('accessToken')
      });

      console.groupEnd();
    };

    // ë””ë²„ê·¸ ì •ë³´ í‘œì‹œ
    window.showDebugInfo = function() {
      console.group('ë””ë²„ê·¸ ì •ë³´');
      console.log('APP_CONFIG:', window.APP_CONFIG);
      console.log('API_ENDPOINTS:', window.API_ENDPOINTS);
      console.log('Layout Manager:', window.layoutManager);
      console.log('Main Page Manager:', window.mainPageManager);
      console.log('Current User:', window.APP_CONFIG.currentUser);
      console.log('Device Type:', window.APP_CONFIG.getDeviceType());
      console.log('Window Size:', {
        width: window.innerWidth,
        height: window.innerHeight
      });
      console.groupEnd();
    };
  }
</script>

<!-- ì¶”ê°€ ë°˜ì‘í˜• ìŠ¤íƒ€ì¼ -->
<style>
  /* ì˜¤í”„ë¼ì¸ ì•Œë¦¼ ì• ë‹ˆë©”ì´ì…˜ */
  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateX(-50%) translateY(-100%);
    }
    to {
      opacity: 1;
      transform: translateX(-50%) translateY(0);
    }
  }

  .offline-alert {
    animation: slideDown 0.3s ease;
  }

  /* PC í—¤ë” ì‚¬ìš©ì ì •ë³´ ìŠ¤íƒ€ì¼ */
  .header-user-info {
    color: var(--text-secondary);
    font-size: 14px;
  }

  .user-greeting {
    font-weight: 500;
  }

  .user-avatar-small {
    object-fit: cover;
    border: 2px solid var(--border-light);
  }

  /* ë””ë°”ì´ìŠ¤ë³„ ìŠ¤íƒ€ì¼ */
  [data-device="mobile"] .pc-only { display: none !important; }
  [data-device="tablet"] .pc-only { display: none !important; }
  [data-device="desktop"] .mobile-only { display: none !important; }

  /* ë¡œë”© ìƒíƒœ ê°œì„  */
  .mobile-layout.loading {
    pointer-events: none;
  }

  .mobile-layout.loading::after {
    content: '';
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(2px);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 9999;
  }

  .mobile-layout.loading::after {
    content: 'ë¡œë”© ì¤‘...';
    font-size: 16px;
    color: var(--text-secondary);
  }

  /* ğŸ”§ FAB ë²„íŠ¼ë“¤ ê´€ë ¨ ìŠ¤íƒ€ì¼ì€ ì´ì œ ê° íŒŒì¼ì—ì„œ ê°•ì œ ì ìš© */
  /* main.jsì—ì„œ ì²´í—˜í•˜ê¸° FAB ìŠ¤íƒ€ì¼ ê´€ë¦¬ */
  /* layout.jsì—ì„œ ì±„íŒ… FAB ìŠ¤íƒ€ì¼ ê´€ë¦¬ */
</style>

</body>
</html>