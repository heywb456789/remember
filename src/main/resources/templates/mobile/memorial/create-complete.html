<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{mobile/layout/default :: html(
        ~{::title},
        ~{::section},
        ~{::customCSS},
        ~{::customJS},
        'memorial',
        'complete'
      )}">
<head>
  <title>ë©”ëª¨ë¦¬ì–¼ ë“±ë¡ ì™„ë£Œ - í† ë§ˆí† ë¦¬ë©¤ë²„</title>

  <!-- Custom CSS -->
  <customCSS>
    <link th:href="@{/assets/mobile/css/memorial-create.css}" rel="stylesheet">
  </customCSS>
</head>
<body>
<section>
  <div class="container">
    <!-- í˜ì´ì§€ í—¤ë” -->
    <div class="page-header">
      <h1 class="page-title">ë©”ëª¨ë¦¬ì–¼ ë“±ë¡ ì™„ë£Œ</h1>
    </div>

    <!-- ì§„í–‰ ìƒíƒœ í‘œì‹œ -->
    <div class="progress-container">
      <div class="progress-bar">
        <div class="progress-fill" style="width: 100%"></div>
      </div>
      <div class="progress-steps">
        <div class="step completed">
          <div class="step-number">
            <i class="fas fa-check"></i>
          </div>
          <div class="step-label">ê¸°ë³¸ ì •ë³´</div>
        </div>
        <div class="step completed">
          <div class="step-number">
            <i class="fas fa-check"></i>
          </div>
          <div class="step-label">ê³ ì¸ ì •ë³´</div>
        </div>
        <div class="step completed">
          <div class="step-number">
            <i class="fas fa-check"></i>
          </div>
          <div class="step-label">ë¯¸ë””ì–´</div>
        </div>
        <div class="step completed">
          <div class="step-number">
            <i class="fas fa-check"></i>
          </div>
          <div class="step-label">ì™„ë£Œ</div>
        </div>
      </div>
    </div>

    <!-- ì™„ë£Œ ë©”ì‹œì§€ -->
    <div class="completion-message">
      <div class="success-icon">
        <i class="fas fa-check-circle"></i>
      </div>
      <h2>ë©”ëª¨ë¦¬ì–¼ ë“±ë¡ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
      <p>ì†Œì¤‘í•œ ì¶”ì–µì„ í•¨ê»˜ ë§Œë“¤ì–´ê°€ìš”.</p>
    </div>

    <!-- ë©”ëª¨ë¦¬ì–¼ ì •ë³´ ì¹´ë“œ -->
    <div class="memorial-info-card">
      <div class="memorial-avatar">
        <img th:src="${memorial.profileImageUrls != null && !memorial.profileImageUrls.empty ? memorial.profileImageUrls[0] : '/assets/images/default-avatar.png'}"
             th:alt="${memorial.name}"
             class="avatar-image">
      </div>
      <div class="memorial-details">
        <h3 th:text="${memorial.name}">ê¹€í• ë¨¸ë‹ˆ</h3>
        <p class="memorial-relationship" th:text="${memorial.relationship?.displayName}">í• ë¨¸ë‹ˆ</p>
        <div class="memorial-dates" th:if="${memorial.birthDate != null || memorial.deathDate != null}">
          <span th:if="${memorial.birthDate != null}" th:text="${#temporals.format(memorial.birthDate, 'yyyyë…„ MMì›” ddì¼')}">1950ë…„ 3ì›” 15ì¼</span>
          <span th:if="${memorial.birthDate != null && memorial.deathDate != null}"> ~ </span>
          <span th:if="${memorial.deathDate != null}" th:text="${#temporals.format(memorial.deathDate, 'yyyyë…„ MMì›” ddì¼')}">2024ë…„ 6ì›” 10ì¼</span>
        </div>
      </div>
    </div>

    <!-- AI í•™ìŠµ ìƒíƒœ -->
    <div class="ai-learning-status">
      <h3>AI í•™ìŠµ ì§„í–‰ ìƒí™©</h3>
      <div class="learning-progress">
        <div class="progress-bar">
          <div class="progress-fill ai-progress" id="aiProgressBar"></div>
        </div>
        <div class="progress-text">
          <span id="aiProgressText">AI í•™ìŠµ ì¤€ë¹„ ì¤‘...</span>
        </div>
      </div>

      <div class="learning-steps">
        <div class="learning-step" id="step-image">
          <div class="step-icon">
            <i class="fas fa-image"></i>
          </div>
          <div class="step-content">
            <h5>ì´ë¯¸ì§€ ë¶„ì„</h5>
            <p id="step-image-status">ëŒ€ê¸° ì¤‘...</p>
          </div>
          <div class="step-status">
            <i class="fas fa-clock"></i>
          </div>
        </div>

        <div class="learning-step" id="step-voice">
          <div class="step-icon">
            <i class="fas fa-volume-up"></i>
          </div>
          <div class="step-content">
            <h5>ìŒì„± í•™ìŠµ</h5>
            <p id="step-voice-status">ëŒ€ê¸° ì¤‘...</p>
          </div>
          <div class="step-status">
            <i class="fas fa-clock"></i>
          </div>
        </div>

        <div class="learning-step" id="step-video">
          <div class="step-icon">
            <i class="fas fa-video"></i>
          </div>
          <div class="step-content">
            <h5>ì˜ìƒ ë¶„ì„</h5>
            <p id="step-video-status">ëŒ€ê¸° ì¤‘...</p>
          </div>
          <div class="step-status">
            <i class="fas fa-clock"></i>
          </div>
        </div>

        <div class="learning-step" id="step-complete">
          <div class="step-icon">
            <i class="fas fa-check"></i>
          </div>
          <div class="step-content">
            <h5>í•™ìŠµ ì™„ë£Œ</h5>
            <p id="step-complete-status">ëŒ€ê¸° ì¤‘...</p>
          </div>
          <div class="step-status">
            <i class="fas fa-clock"></i>
          </div>
        </div>
      </div>

      <div class="learning-time-info">
        <i class="fas fa-info-circle"></i>
        <span>AI í•™ìŠµì€ ì•½ 30ë¶„~1ì‹œê°„ ì†Œìš”ë˜ë©°, ì™„ë£Œ í›„ ì˜ìƒí†µí™”ê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤.</span>
      </div>
    </div>

    <!-- ì™„ë£Œ í›„ ì•¡ì…˜ -->
    <div class="completion-actions">
      <div class="action-grid">
        <div class="action-card" onclick="goToMemorialDetail()">
          <div class="action-icon">
            <i class="fas fa-eye"></i>
          </div>
          <div class="action-content">
            <h4>ë©”ëª¨ë¦¬ì–¼ ë³´ê¸°</h4>
            <p>ë“±ë¡ëœ ë©”ëª¨ë¦¬ì–¼ì„ í™•ì¸í•´ë³´ì„¸ìš”</p>
          </div>
        </div>

        <div class="action-card" onclick="goToVideoCall()" id="videoCallAction">
          <div class="action-icon">
            <i class="fas fa-video"></i>
          </div>
          <div class="action-content">
            <h4>ì˜ìƒí†µí™”</h4>
            <p>AI í•™ìŠµ ì™„ë£Œ í›„ ê°€ëŠ¥í•©ë‹ˆë‹¤</p>
          </div>
        </div>

        <div class="action-card" onclick="goToTribute()">
          <div class="action-icon">
            <i class="fas fa-heart"></i>
          </div>
          <div class="action-content">
            <h4>ì¶”ëª¨í•˜ê¸°</h4>
            <p>ì†Œì¤‘í•œ ì¶”ì–µì„ ë‚¨ê²¨ë³´ì„¸ìš”</p>
          </div>
        </div>

        <div class="action-card" onclick="showShareModal()">
          <div class="action-icon">
            <i class="fas fa-share-alt"></i>
          </div>
          <div class="action-content">
            <h4>ê³µìœ í•˜ê¸°</h4>
            <p>ê°€ì¡±ê³¼ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜í•´ìš”</p>
          </div>
        </div>
      </div>
    </div>

    <!-- ë©”ì¸ ì•¡ì…˜ ë²„íŠ¼ -->
    <div class="main-actions">
      <button type="button" class="btn btn-primary btn-lg" onclick="goToHome()">
        <i class="fas fa-home"></i>
        í™ˆìœ¼ë¡œ ê°€ê¸°
      </button>
      <button type="button" class="btn btn-outline-primary btn-lg" onclick="goToMemorialDetail()">
        <i class="fas fa-eye"></i>
        ë©”ëª¨ë¦¬ì–¼ ë³´ê¸°
      </button>
    </div>
  </div>

  <!-- ê³µìœ  ëª¨ë‹¬ -->
  <div class="modal fade" id="shareModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-share-alt"></i>
            ë©”ëª¨ë¦¬ì–¼ ê³µìœ í•˜ê¸°
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="share-content">
            <p>ì†Œì¤‘í•œ ì¶”ì–µì„ ê°€ì¡±ê³¼ ì¹œêµ¬ë“¤ê³¼ í•¨ê»˜ ë‚˜ëˆ ë³´ì„¸ìš”.</p>

            <div class="share-link">
              <div class="form-group">
                <label class="form-label">ê³µìœ  ë§í¬</label>
                <div class="input-group">
                  <input type="text" class="form-control" id="shareLink" readonly>
                  <button type="button" class="btn btn-outline-primary" onclick="copyShareLink()">
                    <i class="fas fa-copy"></i>
                    ë³µì‚¬
                  </button>
                </div>
              </div>
            </div>

            <div class="share-buttons">
              <button type="button" class="btn-share" onclick="shareToKakao()">
                <i class="fab fa-kakaotalk"></i>
                <span>ì¹´ì¹´ì˜¤í†¡</span>
              </button>
              <button type="button" class="btn-share" onclick="shareToFacebook()">
                <i class="fab fa-facebook"></i>
                <span>í˜ì´ìŠ¤ë¶</span>
              </button>
              <button type="button" class="btn-share" onclick="shareToInstagram()">
                <i class="fab fa-instagram"></i>
                <span>ì¸ìŠ¤íƒ€ê·¸ë¨</span>
              </button>
              <button type="button" class="btn-share" onclick="shareToTwitter()">
                <i class="fab fa-twitter"></i>
                <span>íŠ¸ìœ„í„°</span>
              </button>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            ë‹«ê¸°
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- AI í•™ìŠµ ì™„ë£Œ ì¶•í•˜ ëª¨ë‹¬ -->
  <div class="modal fade" id="aiCompleteModal" tabindex="-1">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">
            <i class="fas fa-star text-warning"></i>
            AI í•™ìŠµ ì™„ë£Œ!
          </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body text-center">
          <div class="celebration-content">
            <div class="celebration-icon">
              <i class="fas fa-trophy"></i>
            </div>
            <h4>ì¶•í•˜í•©ë‹ˆë‹¤!</h4>
            <p>AI í•™ìŠµì´ ì™„ë£Œë˜ì–´ ì´ì œ ì˜ìƒí†µí™”ë¥¼ ì‹œì‘í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>

            <div class="celebration-features">
              <div class="feature-item">
                <i class="fas fa-video text-primary"></i>
                <span>ì‹¤ì‹œê°„ ì˜ìƒí†µí™”</span>
              </div>
              <div class="feature-item">
                <i class="fas fa-comments text-success"></i>
                <span>ìì—°ìŠ¤ëŸ¬ìš´ ëŒ€í™”</span>
              </div>
              <div class="feature-item">
                <i class="fas fa-heart text-danger"></i>
                <span>ë”°ëœ»í•œ ì¶”ì–µ</span>
              </div>
            </div>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-primary" onclick="goToVideoCall()">
            <i class="fas fa-video"></i>
            ì˜ìƒí†µí™” ì‹œì‘í•˜ê¸°
          </button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
            ë‚˜ì¤‘ì— í•˜ê¸°
          </button>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Custom JavaScript -->
<customJS>
  <!-- ì„œë²„ ì‚¬ì´ë“œ ë°ì´í„° ì „ë‹¬ -->
  <script th:inline="javascript">
    window.memorialCompleteData = {
      currentStep: 4,
      maxStep: 4,
      memorial: {
        id: /*[[${memorial.id}]]*/ null,
        name: /*[[${memorial.name}]]*/ 'ê¹€í• ë¨¸ë‹ˆ',
        relationship: /*[[${memorial.relationship?.displayName}]]*/ 'í• ë¨¸ë‹ˆ',
        birthDate: /*[[${memorial.birthDate}]]*/ null,
        deathDate: /*[[${memorial.deathDate}]]*/ null,
        profileImageUrls: /*[[${memorial.profileImageUrls}]]*/ [],
        voiceFileUrls: /*[[${memorial.voiceFileUrls}]]*/ [],
        videoFileUrl: /*[[${memorial.videoFileUrl}]]*/ null,
        userImageUrl: /*[[${memorial.userImageUrl}]]*/ null,
        aiTrainingStatus: /*[[${memorial.aiTrainingStatus}]]*/ 'PENDING',
        aiTrainingCompleted: /*[[${memorial.aiTrainingCompleted}]]*/ false,
        status: /*[[${memorial.status}]]*/ 'ACTIVE'
      },
      aiLearningSteps: [
        { id: 'step-image', label: 'ì´ë¯¸ì§€ ë¶„ì„', progress: 0, status: 'ëŒ€ê¸° ì¤‘...', icon: 'fas fa-image' },
        { id: 'step-voice', label: 'ìŒì„± í•™ìŠµ', progress: 0, status: 'ëŒ€ê¸° ì¤‘...', icon: 'fas fa-volume-up' },
        { id: 'step-video', label: 'ì˜ìƒ ë¶„ì„', progress: 0, status: 'ëŒ€ê¸° ì¤‘...', icon: 'fas fa-video' },
        { id: 'step-complete', label: 'í•™ìŠµ ì™„ë£Œ', progress: 0, status: 'ëŒ€ê¸° ì¤‘...', icon: 'fas fa-check' }
      ],
      urls: {
        memorial: '/memorial/' + /*[[${memorial.id}]]*/ '1',
        home: '/mobile/home',
        videoCall: '/mobile/video-call/' + /*[[${memorial.id}]]*/ '1',
        tribute: '/mobile/memorial/' + /*[[${memorial.id}]]*/ '1' + '/tribute',
        family: '/mobile/family',
        share: window.location.origin + '/memorial/' + /*[[${memorial.id}]]*/ '1'
      }
    };

    // ê°œë°œ ëª¨ë“œ í™œì„±í™”
    if (window.location.search.includes('debug=true')) {
      window.debugMode = true;
      console.log('ğŸ”§ ë©”ëª¨ë¦¬ì–¼ ì™„ë£Œ í˜ì´ì§€ ë””ë²„ê·¸ ëª¨ë“œ í™œì„±í™”');
      console.log('ğŸ“Š ì™„ë£Œ í˜ì´ì§€ ë°ì´í„°:', window.memorialCompleteData);
    }
  </script>

  <!-- ë©”ëª¨ë¦¬ì–¼ ì™„ë£Œ í˜ì´ì§€ JavaScript ë¡œë“œ -->
  <script th:src="@{/assets/mobile/js/memorial-create-complete.js}" type="module"></script>
</customJS>
</body>
</html>